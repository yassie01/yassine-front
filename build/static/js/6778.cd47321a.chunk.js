"use strict";(self.webpackChunkreal_estate=self.webpackChunkreal_estate||[]).push([[6778],{6778:(e,o,l)=>{l.r(o),l.d(o,{default:()=>g});var s=l(89379),t=l(65043),i=l(73216),a=l(5766),r=l.n(a),n=l(4450),d=l(84626),c=l(22554),u=l(63516),v=l(66305),p=l(42145),m=l(86178),f=l.n(m),h=l(69223),y=l.n(h),x=l(10216),b=l(70579);const g=function(){const e=(0,i.zy)(),{fileData:o,customFields:l}=e.state||{},[a,m]=(0,t.useState)([]),[h,g]=(0,t.useState)([]),[S,j]=(0,t.useState)(!1),w=(0,i.Zp)(),[C,F]=(JSON.parse(localStorage.getItem("user"))._id,(0,t.useState)([])),k=Object.fromEntries((l||[]).map((e=>[null===e||void 0===e?void 0:e.name,""]))),I=(0,s.A)({},k),E=[...null===l||void 0===l?void 0:l.map((e=>{var o;return{Header:null===e||void 0===e?void 0:e.label,accessor:null===e||void 0===e?void 0:e.name,type:null===e||void 0===e?void 0:e.type,formikType:null===e||void 0===e||null===(o=e.validations)||void 0===o?void 0:o.find((e=>e.hasOwnProperty("formikType")))}}))],H=(0,u.Wx)({initialValues:I,onSubmit:(e,o)=>{let{resetForm:l}=o;const s=null===h||void 0===h?void 0:h.map(((o,l)=>{const s={createdDate:new Date,deleted:o[e.deleted||"deleted"]||!1,createBy:JSON.parse(localStorage.getItem("user"))._id,modifiedBy:JSON.parse(localStorage.getItem("user"))._id};return null===E||void 0===E||E.forEach((l=>{var t,i,a,r;const n=e[null===l||void 0===l?void 0:l.accessor],d=o[n]||"";"date"===(null===l||void 0===l||null===(t=l.type)||void 0===t?void 0:t.toLowerCase())?s[null===l||void 0===l?void 0:l.accessor]=f()(d).isValid()?d:"":"number"===(null===l||void 0===l||null===(i=l.type)||void 0===i?void 0:i.toLowerCase())&&["positive","negative"].includes(null===l||void 0===l||null===(a=l.formikType)||void 0===a?void 0:a.toLowerCase())?s[null===l||void 0===l?void 0:l.accessor]=parseFloat(d)||"":"number"===(null===l||void 0===l||null===(r=l.type)||void 0===r?void 0:r.toLowerCase())?s[null===l||void 0===l?void 0:l.accessor]=parseInt(d,10)||"":s[null===l||void 0===l?void 0:l.accessor]=d})),s}));_(s)}}),{errors:B,touched:G,values:O,handleBlur:T,handleChange:A,handleSubmit:L,setFieldValue:R,resetForm:W}=H,_=async e=>{try{j(!0),200===(await(0,v.d_)("api/quotes/addMany",e)).status&&(p.oR.success("Quotes imported successfully"),W(),w("/quotes"))}catch(o){console.error(o),p.oR.error("Quotes import failed"),W(),w("/quotes")}finally{j(!1)}};return(0,t.useEffect)((()=>{if(o&&o.length>0){(async e=>{const o=new FileReader,l=e.name.split(".").pop().toLowerCase();if(o.onload=async e=>{let{target:o}=e;if("csv"===l){const e=r().parse(o.result,{header:!0}),l=null===e||void 0===e?void 0:e.data;if(l&&l.length>0){g(l);const e=Object.keys(l[0]);m(e)}else p.oR.error("Empty or invalid CSV file"),w("/quotes")}else if("xlsx"===l){const e=new Uint8Array(o.result),l=new(y().Workbook);await l.xlsx.load(e);const s=l.getWorksheet(1),t=[];if(s.eachRow({includeEmpty:!0},((e,o)=>{const l={};e.eachCell({includeEmpty:!0},((e,o)=>{l[s.getCell(1,o).value]=e.value})),t.push(l)})),null===t||void 0===t||t.splice(0,1),g(t),t&&t.length>0){const e=Object.keys(t[0]);m(e)}else p.oR.error("Empty or invalid XLSX file"),w("/quotes")}},"csv"===l)o.readAsText(e);else if("xlsx"===l){const l=new Blob([e]);o.readAsArrayBuffer(l)}})(o[0])}}),[o]),(0,t.useEffect)((()=>{const e=null===a||void 0===a?void 0:a.filter((e=>{const o=null===E||void 0===E?void 0:E.find((o=>e===(null===o||void 0===o?void 0:o.accessor)||e===(null===o||void 0===o?void 0:o.Header)));return!!o&&(R(null===o||void 0===o?void 0:o.accessor,e),!0)}));F(e)}),[a]),(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(x.A,{overflowY:"auto",className:"importTable",children:[(0,b.jsx)(n.Text,{color:"secondaryGray.900",fontSize:"22px",fontWeight:"700",mb:"20px",children:"Import Quotes"}),(0,b.jsx)(n.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,pb:2,gap:1,borderBottom:"1px solid #e2e8f0",children:[{Header:"Fields In Crm",accessor:"crmFields"},{Header:"Fields In File",accessor:"fileFields"}].map(((e,o)=>(0,b.jsx)(n.GridItem,{colSpan:{base:6},fontWeight:"600",fontSize:{sm:"14px",lg:"14px"},color:"secondaryGray.900",style:{textTransform:"uppercase"},children:e.Header},o)))}),(0,b.jsx)(n.Grid,{templateColumns:"repeat(12, 1fr)",mb:3,gap:1,overflowY:"auto",children:null===E||void 0===E?void 0:E.map(((e,o)=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.GridItem,{colSpan:{base:6},mt:"10px",children:e.Header},e.id),(0,b.jsx)(n.GridItem,{colSpan:{base:4},children:(0,b.jsxs)(d.l6,{variant:"flushed",fontWeight:"500",isSearchable:!0,value:O[e.accessor],name:e.accessor,onChange:A,children:[(0,b.jsxs)("option",{value:"",children:[" ",C&&C.find((o=>(e.Header===o||e.accessor===o)&&o))?C.find((o=>(e.Header===o||e.accessor===o)&&o)):"Select Field In File"]}),null===a||void 0===a?void 0:a.map((e=>(0,b.jsx)("option",{value:e,children:e},e)))]})})]})))}),(0,b.jsx)(n.Flex,{Flex:!0,justifyContent:"end",mt:"5",children:(0,b.jsx)(c.Button,{size:"sm",onClick:()=>L(),variant:"brand",children:"Save"})})]})})}}}]);
//# sourceMappingURL=6778.cd47321a.chunk.js.map